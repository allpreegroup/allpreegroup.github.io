<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invitation Sign-Up</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
    .hidden { display: none; }
    .form-section, .invite-section { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, select { width: 100%; padding: 10px; margin: 10px 0; }
    button { padding: 10px 20px; background: green; color: white; border: none; cursor: pointer; }
    button:disabled { background: grey; }
    .error { color: red; }
  </style>
</head>
<body>

<div class="invite-section">
  <h2>Enter Invitation Code</h2>
  <input type="text" id="inviteCodeInput" placeholder="Enter your code (e.g. J388640)" required />
  <button id="validateBtn">Continue</button>
  <p class="error" id="inviteError" style="display:none;">Invalid invitation code. Please try again.</p>
</div>

<div class="form-section hidden" id="signupFormSection">
  <h2>Sign Up</h2>
  <form id="signupForm" target="hidden_iframe" onsubmit="submitted=true" action="https://docs.google.com/forms/u/0/d/e/1FAIpQLSfw0Sts9wFjaExeOLWxUGAhdrEbfMEE2n6kh430bFqb0xKO2w/formResponse" method="post">
    
    <!-- Auto-fill these with JS -->
    <input type="hidden" name="entry.1092645840" id="field_ID">
    <input type="hidden" name="entry.2034350499" id="field_Code">
    
    <!-- Standard inputs -->
    <input type="text" name="entry.1502543154" placeholder="First Name" required>
    <input type="text" name="entry.166208811" placeholder="Last Name" required>
    <input type="email" name="emailAddress" placeholder="Email Address" required>
    <input type="tel" name="entry.1897494140" placeholder="Phone Number" required>
    
    <select name="entry.208508536" required>
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
    </select>

    <select name="entry.577240945" required>
      <option value="">Birth Year</option>
      <script>
        const yearSelect = new Date().getFullYear();
        for (let y = yearSelect - 50; y <= yearSelect - 10; y++) {
          document.write(`<option>${y}</option>`);
        }
      </script>
    </select>

    <br><button type="submit">Agree and Continue</button>
  </form>
</div>

<!-- Hidden iframe for Google Form redirect -->
<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="if(submitted) {window.location='/thankyou/';}"></iframe>

<script>
  const inviteBtn = document.getElementById('validateBtn');
  const inviteInput = document.getElementById('inviteCodeInput');
  const errorText = document.getElementById('inviteError');
  const formSection = document.getElementById('signupFormSection');
  let submitted = false;

  inviteBtn.onclick = async () => {
    const code = inviteInput.value.trim().toUpperCase();
    if (!code) return;

    try {
      const res = await fetch("https://opensheet.vercel.app/YOUR_SHEET_ID/Sheet1");
      const data = await res.json();
      const match = data.find(row => row.Code?.toUpperCase() === code);

      if (match) {
        // Valid code â€“ show form and inject values
        document.getElementById('field_ID').value = `ID ${code}`;
        document.getElementById('field_Code').value = code;
        formSection.classList.remove('hidden');
        document.querySelector('.invite-section').classList.add('hidden');
        errorText.style.display = "none";
      } else {
        errorText.style.display = "block";
      }
    } catch (e) {
      console.error("Error checking code:", e);
      errorText.style.display = "block";
    }
  };
</script>

</body>
</html>
