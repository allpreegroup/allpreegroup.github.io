<meta name="viewport" content="width=device-width, initial-scale=1.0"/> 
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    
<style>
   .favorite-brand-badge {
    
    color: #fff;
     font-weight: bold;
  padding: 2px 10px;
  border-radius: 20px;
  position: absolute;
  top: -10px;
  right: -225px;
  font-size: 12px;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}	
 .brand-logo-container {
  position: absolute; /* Needed for badge positioning */
 
}
		 
.favorite-brand-highlight {
  --highlight-border-color: gold; /* Default fallback */
  border: 3px solid var(--highlight-border-color);
  border-radius: 12px;
  padding-left: 50px;
  padding-right: 50px;
}

.top-ranked-badge {
  background-color:  #f5f5f5;
  color: #000;
  font-weight: bold;
  padding: 2px 10px;
  border-radius: 20px;
  position: absolute;
  top: -10px;
  right: -225px;
  font-size: 12px;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}
.brand-logo-container {
  position: absolute; /* Needed for badge positioning */
 
}

.location-badge {
  background-color: #f5f5f5;
  color: #000;
  font-weight: bold;
  padding: 2px 10px;
  border-radius: 20px;
  position: absolute;
  top: -10px;
  right: -70px;
  font-size: 12px;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}
.brand-logo-container {
  position: absolute; /* Needed for badge positioning */
 
}
		 
.top-deal-badge {
  background-color: gold;
  color: #000;
  font-weight: bold;
  padding: 2px 10px;
  border-radius: 20px;
  position: absolute;
  top: -10px;
  right: -225px;
  font-size: 12px;
  box-shadow: 0 0 8px rgba(0,0,0,0.2);
}
.brand-logo-container {
  position: absolute; /* Needed for badge positioning */
 
}
	     
	     
.top-brand-highlight {
	
  border: 3px solid gold;	
  border-radius: 12px;
  animation: glowPulse 2s ease-in-out infinite;
  box-shadow: 0 0 10px gold;
  
  padding-left: 50px;
  padding-right: 50px;
}

@keyframes glowPulse {
  0% {
    box-shadow: 0 0 10px gold;
  }
  50% {
    box-shadow: 0 0 20px orange;
  }
  100% {
    box-shadow: 0 0 10px gold;
  }
}

     .countdown-timer {
  font-weight: bold;
  color: #007bff;
}

.countdown-urgent .countdown-timer {
  color: #ff4136;
  animation: blink 1s step-start 0s infinite;
}

.countdown-ended {
  color: gray;
}

@keyframes blink {
  50% {
    opacity: 0;
  }
}

	
    .countdown {
      text-align: center;
      font-size: 18px;
      margin-bottom: 20px;
    }
		 
    .brand-section {
      margin-bottom: 30px;
		    
    }

.countdown-upcoming {
  color: orange;
  font-style: italic;
}
		 
    .brand {
  display: flex;
  align-items: center;
  gap: 12px;
	    
  margin-left: -15px;
  margin-right: -15px;
  width: calc(100% + 30px); /* wider than container */    
  
  background-color: #fff;
  padding: 1px 1px;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  margin-bottom: 1px;
  min-height: 7px;
}

.brand-logo-container {
 
height: 60px;
  width: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.brand-logo-container img {
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  border-radius: 8px;
}
    .brand img {
      width: 100px;
      height: 100px;
      margin-left: 8px;
      border-radius: 1px;
      object-fit: contain;
    }
    .brand-name {
      font-size: 18px;
      font-weight: bold;
      margin-left: 67px;
    }
    .brand-timer {
  font-size: 14px;
  margin-left: 67px;
    }

    .deal {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      flex: 0 0 auto;
      margin-left: -20px;
      margin-right: -20px;
      width: 100%;
      scroll-snap-align: start;
      position: relative;
      cursor: pointer;
    }

	.deal-item {
  opacity: 0;
  transform: translateY(10px);
  animation: fadeInUp 0.3s ease forwards;
}

@keyframes fadeInUp {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
	 
		 
    .deal-grid {
      display: grid;
      grid-auto-flow: column;
      grid-template-rows: repeat(1, 1fr); /* 2 rows */
      grid-auto-columns: 54.2%;  
       
       margin-left: -5px;
       margin-right: -5px;
	    
      gap: 15px;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      padding: 10px 20px;  /*Slightly more padding for breathing room */
      scrollbar-width: none; /* Firefox */
    }
		 
    .deal-grid.takeover-active {
      grid-template-rows: repeat(2, 1fr); /* 2 rows for takeover */
    }
    .deal-grid::-webkit-scrollbar {
      display: none; /* Chrome, Safari */
	    
    }
    .deal img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }
    .deal-content {
      padding: 10px;
      
    }
    .deal-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .price {
      color: #999;
      text-decoration: line-through;
      font-size: 14px;
    }
    .discount {
      color: #e60000;
      font-weight: bold;
      font-size: 16px;
    }
    .discount-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background: red;
      color: white;
      font-weight: bold;
      font-size: 12px;
      padding: 4px 6px;
      border-radius: 4px;
    }

     /* Popup Styles */
.popup-overlay {
  position: fixed;
  top: 0;
  left: 0;
 width: 100%;
    height: 100%;
  background: linear-gradient(
    to bottom,
    rgba(0, 0, 0, 1) 0%,
    rgba(0, 0, 0, 1) 10%,
    rgba(0, 0, 0, 1) 20%,
    rgba(0, 0, 0, 1) 30%,
    rgba(0, 0, 0, 1) 40%,
    rgba(0, 0, 0, 1) 50%,
    rgba(0, 0, 0, 1) 60%,
    rgba(0, 0, 0, 1) 70%,
    rgba(0, 0, 0, 1) 80%,
    rgba(0, 0, 0, 1) 90%,
    rgba(0, 0, 0, 1) 100%
  );
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  flex-direction: column;
  gap: 20px;
}

.popup-content {
  background: white;
  justify-content: center;
  border-radius: 10px;
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  position: relative;	
}


.tab-switcher {
  display: flex;
  width: 50%;
  justify-content: center;
  background: black;
  margin-top: -0px; /* or try -10px if you want to pull it up */	
  padding: 5px 0;
}

.tab-btn {
  flex: 1;
  background: transparent;
  border: none;
  font-size: 16px;
  font-weight: bold;
  color: rgba(255, 255, 255, 0.5);
  padding: 5px;
  position: relative;
  cursor: pointer;
}

.tab-btn.active {
  color: #fff;
}

.tab-btn.active::after {
  content: "";
  position: absolute;
  bottom: -2px;
  left: 50%;
  transform: translateX(-50%);
  width: 30px;
  height: 3px;
  background: #fff;
  border-radius: 2px;
}

		 
.image-wrapper {
  width: 100%;
  height: 200px; /* Fixed container height */
  background: #f9f9f9;
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  overflow: hidden; /* Important: clip the image if needed */
  display: flex;
  align-items: center;
  justify-content: center;
}

.image-wrapper img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain; /* Show full image inside without cutting */
  display: block;
}

.popup-body {
  padding: 20px;
}

.popup-title {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
}

.popup-price {
  font-size: 14px;
  text-decoration: line-through;
  color: #888;
}

.popup-discount {
  font-size: 18px;
  color: #e60000;
  font-weight: bold;
}
		
.popup-cashback {
  font-weight: bold;
  color: #28a745;
  font-size: 13px;
}	
		
.final-price {
  margin-top: -10px;  
  margin-bottom: 10px;
  color: #e60000; /* Green shade for positive pricing */
  font-weight: bold;
  font-size: 12px;
}
		
.popup-discount-badge {
  position: absolute;
  top: 15px;
  right: 15px;
  background: red;
  color: white;
  font-weight: bold;
  font-size: 9px;
  padding: 5px 8px;
  border-radius: 4px;
  z-index: 10;
}
		 /* Style for the Like Button */
.like-btn {
  font-size: 2rem;
  background: none;
  border: none;
  cursor: pointer;
  transition: transform 0.2s ease;
  position: absolute; /* Position it inside the container */
  bottom: -123px; /* Pushes the button down */
  right: 15px; /* Adjust to your desired position (can be changed to center, right, etc.) */
  color: black; /* Initial color */
  z-index: 10; /* Ensures it's above other content */
}

.like-btn.liked {
  color: red;
  transform: scale(1.2); /* Enlarges the button when liked */
}

.popup-savings {
  position: absolute; /* Position it absolutely */
  top: 15px; /* Adjust position as needed */
  left: 15px; /* Align to the right side */
  background: #28a745; /* Green color for savings */
  color: white;
  font-weight: bold;
  font-size: 12px;
  padding: 5px 8px;
  border-radius: 4px;
  z-index: 10; /* Ensure it stays above other elements */
}


.popup-description {
  font-size: 9px;
  padding-top: 10px;
}

.popup-close {
  position: absolute;
  top: 10px;
  right: 15px;
  font-size: 28px;
  color: #333;
  cursor: pointer;
  font-weight: bold;
}

.popup-brand-box {
 margin: 10px 20px 20px 20px; /* Top, horizontal, bottom */
  padding: 10px;
  border-top: 1px solid #eee;
  background-color: #fdfdfd;
  border-radius: 8px;
  display: flex;
  flex-direction: column; /* Stack brand name and timer vertically */
  align-items: flex-start; /* Align to the left */
  gap: 8px; /* Space between brand name and timer */
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
}

.popup-brand-box .brand-logo-container {
  height: 50px;
  width: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.popup-brand-box .brand-logo-container img {
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
  border-radius: 6px;
}

.popup-brand-box .brand-name {
  font-size: 16px;
  font-weight: bold;
}

.popup-brand-box .brand-timer {
  font-size: 14px;
  color: #555;
}
		 
#brandContainer .badge-premium,
#brandContainer	.badge-starter, 
#brandContainer .badge-exclusive,	 
#brandContainer .badge-pro {
  position: absolute;
  top: -30px;
  right: 4px;
  font-size: 24px;
  padding: 3px 8px;
  z-index: 2;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}	


.popup-back-arrow {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  font-size: 22px;
  color: #888;
  cursor: pointer;
  display: none;
  z-index: 11;
  padding: 6px 10px;
  border-radius: 4px;
}

.popup-back-arrow:hover {
  color: black;
}
		 

/* Liked Deals Gallery (Horizontal Scroll) */
#likedDealsSection {
  border: 0px ;
  padding-top: 0;
  padding-right: 1rem;
  padding-bottom: 1rem;
  padding-left: 1rem;
  
  box-shadow: 0 0 0px;
  margin-bottom: 40px;
  animation: fadeInUp 0.4s ease-in-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(15px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}


/* Deal Grid Style for Liked Deals */
#likedDealsGallery {
display: grid;
  grid-auto-flow: column;
  grid-template-rows: repeat(1, 1fr); /* Two rows if needed */
  grid-auto-columns: 54.2%;
  gap: 15px;
  overflow-x: auto;
  scroll-snap-type: x mandatory;
  padding: 10px 20px;
  margin-left: -5px;
  margin-right: -5px;
  margin-top: -25px; /* Pulls the gallery up */
  scrollbar-width: none; /* Firefox */
}

#likedDealsGallery::-webkit-scrollbar {
  display: none; /* Chrome & Safari */
}

/* Style for the container around the brand logo (liked-deal-brand) */
.liked-deal-brand {
height: 40px;
  width: 40px;
  display: flex;
	border: 3px solid #163a5c; /* Glowing border */
  align-items: center;
  justify-content: center;
	border-radius: 50%;
	overflow: hidden;
	object-position: top;
	position: relative;
	margin-top: 10px;
        margin-left: 10px;
}

/* Styling for the image inside the brand logo container */
.liked-deal-brand-img {
  max-height: 100%;
  max-width: 100%;
  object-fit: contain;
	
  border-radius: 8px;
  align-items: center;
  padding: 3px;
  justify-content: center;
}

		 
/* Card style for each liked deal */
.liked-deal-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  flex: 0 0 auto;
  width: 100%;
  scroll-snap-align: start;
  position: relative;
  cursor: pointer;
  transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.liked-deal-card:hover {
  transform: scale(1.05);
  box-shadow: 0 0 15px rgba(255, 111, 97, 0.7);
}
		 
/* Optional glow if liked */
.liked-deal-card.liked {
   border: 2px solid #ff6f61;
  box-shadow: 0 0 15px rgba(255, 111, 97, 0.7);
}

/* Image Styling */
.liked-deal-card-img {
  width: 65%;
  height: 65%;
  margin-top: -20px;
  object-fit: contain; /* shows entire image without cropping */
  border-top-left-radius: 10px;
  border-top-right-radius: 10px;
  background-color: white; /* background: #f9f9f9; *//* optional: adds background behind image if needed */
  padding: 30px; /* optional: gives image breathing room */
}

/* Card Content */
.liked-deal-content {
 padding-left: 12px;
height: 20%;
}
		 
.liked-deal-title {
  font-size: 9px;
  font-weight: bold;
  margin-top: -25px;
  margin-bottom: 5px;
}

.liked-deal-price {
  color: #999;
  text-decoration: line-through;
  font-size: 14px;
}


.liked-deal-discount {
 color: #e60000;
  font-weight: bold;
  font-size: 16px;
}

/* Discount badge */
.liked-discount-badge {
  position: absolute;
  top: 16.6px;
  right: 10px;
  background: red;
  color: white;
  font-weight: bold;
  font-size: 10px;
  padding: 4px 6px;
  border-radius: 4px;
}

#cartBtnContainer.hidden {
  display: none !important;
}

#popupAddToCartBtn {
  font-size: 2rem;
  background: none;
  border: none;
  cursor: pointer;
  transition: transform 0.2s ease;
  position: absolute;
  bottom: -123px;
  right: 15px;
  color: black;
  z-index: 10;
}

#popupAddToCartBtn.in-cart {
  color: green;
  transform: scale(1.2);
}
	 
.cart-icon {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 24px;
  cursor: pointer;
}

.cart-count {
  position: absolute;
  top: -8px;
  right: -8px;
  background-color: red;
  color: white;
  border-radius: 50%;
  font-size: 12px;
  padding: 2px 6px;
}
#cart-icon-container {
  position: fixed;
  top: 10px;
  right: 10px;
  z-index: 1000;
}

#cart-icon {
  font-size: 24px;
  background: white;
  border-radius: 50%;
  padding: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  cursor: pointer;
}
#cartBtn {
  display: flex;
  align-items: center;
  gap: 4px; /* space between icon and count */
  font-size: 12px;
}
		 
.cart-icon2 {
  font-size: 20px;
  padding: 0px;
  cursor: pointer;
}
.cart-count2 {
  font-weight: bold;
  background-color: red;
  color: white;
  padding: 2px 6px;
  border-radius: 50%;
  font-size: 12px;
}
		 
/* Badge styles for premium and pro tiers */
.badge-premium, .badge-pro, .badge-starter, .badge-exclusive {
  background-color: transparent;
  border: 0.0px solid  #000;
  color: #fff;
  font-weight: bold;
  padding: 0px 0px;
  border-radius: 20px;
  position: absolute;
  top: -15px;
  right: 10px;
  font-size: 24px;
  z-index: 2;
  box-shadow: 0 0 0px #f5f5f5;
}
		 
.premium-brand-highlight {
  border: 3px solid  #f5f5f5;
  border-radius: 12px;
  box-shadow: 0 0 10px  #f5f5f5;
 
}

.pro-brand-highlight {
  border: 3px solid  #f5f5f5;
  border-radius: 12px;
  box-shadow: 0 0 15px  #f5f5f5;
  
}
.starter-brand-highlight {
  border: 3px solid #f5f5f5;
  border-radius: 12px;
  box-shadow: 0 0 8px #f5f5f5;
}

.exclusive-brand-highlight {
  border: 3px solid #f5f5f5;
  border-radius: 12px;
  box-shadow: 0 0 12px #f5f5f5;
}
.brand-logo-container {
  position: absolute; /* Needed for badge positioning */
 
}
		 
  /* SPLASH SCREEN SCOPED STYLES */
  #splash-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #e7ebf2;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    z-index: 9999;
  }

  #splash-screen video {
    max-width: 90vw;
    max-height: 90vh;
    width: 320px;
    height: auto;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }

  #splash-screen .loading-text {
    margin-top: 24px;
    font-family: Arial, sans-serif;
    color: #333;
    font-size: 18px;
    text-align: center;
    display: flex;
    gap: 2px;
    flex-wrap: wrap;
    justify-content: center;
  }

  #splash-screen .loading-text span {
    opacity: 0;
    animation: fadeInLetter 0.5s forwards;
  }

  @keyframes fadeInLetter {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }	


/* Main Admin Panel */
#adminPanel {
  display: none;
  position: fixed;
  bottom: 60px;
  left: 10px;
  background: #ffffff;
  border-radius: 12px;
  padding: 16px;
  width: 280px;
  max-height: 80vh;         /* Limit height */
  overflow-y: auto;         /* Enable vertical scrolling */
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  font-size: 14px;
  z-index: 9999;
}
		 
#rankSlotButtonsContainer {
  display: flex;
  gap: 5px;  /* Space between buttons */
  justify-content: start;  /* Align buttons to the left */
  margin-bottom: 10px;  /* Adjust margin as needed */
}		 

/* Style for rank slot buttons */
.rankSlotBtn {
  padding: 5px 5px; /* Smaller padding */
  font-size: 12px;   /* Smaller text size */
  margin: 0 5px;     /* Space between buttons */
  cursor: pointer;
  background-color: #f0f0f0;
  border: 1px solid #ccc;
  border-radius: 5px;
  transition: background-color 0.3s ease;
}

/* Hover effect for buttons */
.rankSlotBtn:hover {
  background-color: #e0e0e0;
}
		 
		 
/* Buttons Inside Panel */
#adminPanel button {
  margin-top: 8px;
  margin-bottom: 8px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 8px;
  padding: 10px 14px;
  cursor: pointer;
  font-size: 14px;
  width: 100%;
  transition: background-color 0.25s ease;
}

#adminPanel button:hover {
  background-color: #2980b9;
}

/* Close Button Styling */
#closeAdminPanelBtn {
  background-color: #e74c3c;
  font-weight: 600;
}

#closeAdminPanelBtn:hover {
  background-color: #c0392b;
}

/* Labels & Inputs */
#adminPanel label {
  display: block;
  margin-top: 12px;
  margin-bottom: 4px;
  font-weight: 600;
  color: #333;
}

#adminPanel input[type="datetime-local"] {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 14px;
  box-sizing: border-box;
  transition: border-color 0.3s;
}

#adminPanel input[type="datetime-local"]:focus {
  border-color: #3498db;
  outline: none;
}

/* Takeover Backdrop */
#admin-takeover-brand-backdrop {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 68px;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

#admin-takeover-brand-popup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 16px;
  width: 90%;
  max-width: 500px;
  height: 60%;
  max-height: 70vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  z-index: 9999;
}

#admin-takeover-brand-popup::-webkit-scrollbar {
  display: none;
}


		 
/* Backdrop */
#admin-favorite-brand-backdrop,
#admin-single-rank-backdrop{
  position: fixed;
  top: 0;
  left: 0;
  bottom: 68px;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
}

/* Brand Popup */
#admin-favorite-brand-popup,
#admin-single-rank-backdrop {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: #fff;
  border: 1px solid #ddd;
  border-radius: 12px;
  padding: 16px;
  width: 90%;
  max-width: 500px;
  height: 60%;
  max-height: 70vh;
  overflow-y: auto;
  scrollbar-width: none;
  -ms-overflow-style: none;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
  z-index: 9999;
}

#admin-favorite-brand-popup::-webkit-scrollbar {
  display: none;
}

/* Brand Carousel */
.admin-brand-carousel {
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: scroll;
  max-height: 60vh;
  padding: 10px;
}

/* Brand Card Styling */
.admin-brand-card {
  width: 100%;
  display: flex;
  align-items: center;
  padding: 10px 14px;
  border: 1px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  background-color: #f9f9f9;
  transition: all 0.25s ease;
}

.admin-brand-card:hover {
  transform: scale(1.03);
  background-color: #f0f0f0;
}

.admin-brand-card.selected {
  border: 2px solid #e74c3c;
  background-color: #ffe6e6;
}

.admin-brand-card img {
  width: 42px;
  height: 42px;
  margin-right: 16px;
  border-radius: 50%;
}

body.no-scroll {
  overflow: hidden;
}	
		 
#loading-modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background-color: rgba(255, 255, 255, 0.8);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 10005;
  display: none;
}

#loading-spinner {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #333;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  animation: spin 1s linear infinite;
  margin-bottom: 10px;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
#a2hs-popup {
      display: none;
      position: fixed;
      bottom: 80px;
      left: 0;
      right: 0;
      background: #fff;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
      padding: 16px;
      z-index: 99999;
      font-family: sans-serif;
    }
    #a2hs-popup .content {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    #a2hs-install-btn {
      background: #0071ce;
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    #a2hs-close {
      margin-left: 10px;
      font-size: 20px;
      background: none;
      border: none;
      cursor: pointer;
    }
    .section {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      max-width: 700px;
      margin: 20px auto;
    }
    .columns2 {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .column2 {
      flex: 1 1 45%;
      display: flex;
      gap: 15px;
      align-items: flex-start;
      background: #ffff;
      padding: 15px;
      border-radius: 10px;
    }

    .emoji2 {
      font-size: 1.5rem;
      flex-shrink: 0;
      line-height: 1;
    }
   
    .content2 h1 {
      margin: 0 0 10px;
      font-size: 1.2rem;
      font-weight: bold;
    }

    .content2 p {
      margin: 0;
      font-size: 1.0rem;
      line-height: 1.5;
    }

   .menu-button[data-view="signup"] {
     visibility: hidden;
     position: absolute;
     left: -9999px;
}
.menu-button[data-view="topup"] {
     visibility: hidden;
     position: absolute;
     left: -9999px;
}
.menu-button[data-view="generategiftcard"] {
     visibility: hidden;
     position: absolute;
     left: -9999px;
}		 
#leaderboardPopup {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 90%;
  background-color: #fff;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  padding: 10px;
  z-index: 9999;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  display: none; /* Hidden by default */
}


  #leaderboardPopup.show {
    display: block;
  }

  #leaderboardPopup h2 {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 16px;
    text-align: center;
    color: #333;
  }

  #leaderboardContent {
    max-height: 400px;
    overflow-y: auto;
  }

  .leaderboard-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f5f5f5;
    border-radius: 8px;
    padding: 8px 12px;
    margin-bottom: 8px;
    transition: background-color 0.2s ease;
  }

  .leaderboard-row:hover {
    background-color: #e0e0e0;
  }

  .leaderboard-left {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .leaderboard-idcode {
    background-color: #ccc;
    color: #333;
    font-size: 12px;
    font-weight: bold;
    padding: 4px 8px;
    border-radius: 8px;
    min-width: 50px;
    text-align: center;
  }

  .leaderboard-name {
    font-size: 14px;
    color: #222;
    font-weight: 600;
  }

  .leaderboard-points {
    font-size: 14px;
    font-weight: 700;
    color: #1e40af; /* blue-800 */
  }

  .leaderboard-tabs {
  display: flex;
  justify-content: center;
  border-bottom: 2px solid #ddd;
  margin-bottom: 12px;
}

.leaderboard-tab {
  padding: 10px 16px;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  text-align: center;	
  color: #666;
  position: relative;
}

.leaderboard-tab.active {
  color: #1e40af; /* Blue for active */
}

.leaderboard-tab.active::after {
  content: "";
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 3px;
  background-color: #1e40af;
  border-radius: 2px 2px 0 0;
}
#sponsorTakeover {
  padding: 10px;
  text-align: center;
  margin-bottom: 20px;
}

.takeover-banner img {
  max-width: 50px;
  border-radius: 50%;
  margin-bottom: 8px;
}

.takeover-heading {
  font-size: 16px;
  text-align: center;
  font-weight: bold;
  color: #1e40af;
}

.takeover-description {
  font-size: 14px;
  text-align: center;
  color: #333;
}

		 
  /* Close button */
  .close-button {
    position: absolute;
    top: 12px;
    right: 16px;
    font-size: 24px;
    color: #666;
    background: none;
    border: none;
    cursor: pointer;
  }
  .close-button:hover {
    color: #111;
  }

.help-section {
    max-width: 600px;
    margin: 0 auto;
    padding-bottom: 80px;
    font-family: Arial, sans-serif;
    font-size: 14px;
  }
  .accordion {
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 8px;
  }
  .accordion-header {
    background: #0078d7;
    color: white;
    cursor: pointer;
    padding: 12px 16px;
    font-weight: bold;
    user-select: none;
    font-size: 14px;
  }
  .accordion-content {
    padding: 12px 16px;
    background: #f9f9f9;
    display: none;
    border-top: 1px solid #ccc;
    line-height: 1.6;
  }
  .accordion-header.active {
    background: #005ea2;
  }
  .accordion-content ul {
    padding-left: 18px;
    margin: 0;
  }
  .accordion-content li {
    margin-bottom: 6px;
  }
  .icon {
    margin-right: 6px;
    vertical-align: middle;
  }
.drag-hint {
  text-align: right;
  margin-right: -100px;
  font-size: 0.875rem;
  color: #888;
  z-index: 9999;
  margin-top: -4px;
}

#storyListPopup {
  position: fixed;
  inset: 0;
  background: white;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
}

#storyListContainer {
  background: white;
  padding: 20px;
  max-height: 80vh;
  overflow-y: auto;
  width: 90%;
  max-width: 600px;

  display: grid;
  grid-template-columns: 1fr; /* single column */
  gap: 16px;
  border-radius: 16px;
}
  
#closeStoryListPopupBtn {
  position: fixed;      /* fixed relative to viewport */
  top: 16px;            /* distance from top */
  right: 16px;          /* distance from right */
  z-index: 110;         /* above popup backdrop */
  background: #ff4444;  /* red button */
  border: none;
  color: white;
  font-weight: bold;
  font-size: 20px;
  width: 36px;
  height: 36px;
  border-radius: 18px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
.story-tile {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  background: white;
  border-radius: 12px;
  margin-bottom: 16px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: box-shadow 0.3s ease, transform 0.2s ease;
}

.story-tile:hover {
  transform: translateY(-2px);
}

.story-tile img {
   width: 64px;
  height: 64px;
  object-fit: cover;
  border-radius: 10px;
  flex-shrink: 0;
}

.story-tile h3 {
   font-size: 1.3rem;
  font-weight: 700;
  text-transform: capitalize;
  margin: 0;
  line-height: 1.2;
  color: #222;
}


.swiper {
 position: fixed;      /* Fix it relative to viewport */
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  background: black;    /* Optional: black background for better contrast */
  z-index: 105;         /* Make sure it's above other popups */
  display: none;        /* Hide by default */
}

.swiper-slide {
  background-size: cover;
  background-position: center;
  position: relative;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  z-index: 40;
}

.slide-overlay {
  position: absolute;
  bottom: 0;
  width: 100%;
  padding: 1rem;
  background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
  color: white;
  text-align: center;
  z-index: 50;
}

.slide-title {
  font-size: 2rem;
  font-weight: bold;
  text-transform: capitalize;
}

.slide-desc {
  font-size: 1.2rem;
  margin-top: 0.5rem;
}

.headline-slide .slide-title {
  font-size: 2.5rem;
  font-weight: 800;
  text-transform: uppercase;
  font-family: 'Oswald', sans-serif;
  letter-spacing: 0.05em;
  margin-bottom: 30%;
}

.headline-slide {
  align-items: center !important;
  justify-content: center !important;
}

.cta-container {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 0.5rem;
  margin-top: 0.75rem;
}

.cta-button {
  padding: 0.75rem 1rem;
  border-radius: 10px;
  font-weight: bold;
  font-size: 1rem;
  text-decoration: none;
  cursor: pointer;
  color: #000;
  z-index: 30;
  position: relative;
  flex: 1 1 auto;
  max-width: 25%;
}

.cta-link-button {
  background: #FFD700;
}

.cta-jump-button {
  background: #FF0000;
  color: #fff;
}

.cta-button.close-story-button {
  background-color: transparent;
  border: 2px solid #fff;
  color: #fff;
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 50%;
  margin-left: 10px;
  cursor: pointer;
}

.progress-bar {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  gap: 4px;
  padding: 10px;
  z-index: 10;
}

.progress-segment {
  flex: 1;
  height: 4px;
  background: rgba(255, 255, 255, 0.25);
  border-radius: 2px;
  overflow: hidden;
  backdrop-filter: brightness(0.9);
}

.progress-fill {
  height: 100%;
  width: 0%;
  background: white;
  box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
  transition: width 0.3s ease;
}

.tap-zone {
  position: absolute;
  width: 20%;
  height: 100%;
  top: 0;
  z-index: 20;
}

.tap-left { left: 0; }
.tap-right { right: 0; }

.sponsored-label {
  position: absolute;
  top: 20px;
  right: 10px;
  background: rgba(255, 255, 255, 0.25);
  padding: 4px 8px;
  font-size: 1rem;
  color: #fff;
  border-radius: 4px;
  z-index: 10;
}

.brand-logo {
  position: absolute;
  top: 20px;
  left: 10px;
  height: 32px;
  width: auto;
  border-radius: 6px;
  z-index: 10;
}
  </style>

<button id="viewAllButton">View All Stories</button>

<div id="storyListPopup" style="display: none;">
   <button id="closeStoryListPopupBtn">X</button>
  <div id="storyListContainer" class="story-grid"></div>
</div>

<div class="swiper" style="display:none;">
  <div class="swiper-wrapper" id="storyWrapper"></div>
  <div class="progress-bar" id="progressBar"></div>
  <div class="tap-zone tap-left" id="tapLeft"></div>
  <div class="tap-zone tap-right" id="tapRight"></div>
</div>


				  
<!-- Slide-up panel content area -->
<div id="panel" class="slide-up-panel">
  <div id="handle">
	<div class="drag-hint">⬆️⬇️ Drag up or down</div>  
  </div>
  <div id="panelContent">
	  
<div class="help-section">
 

   <div class="accordion">
    <div class="accordion-header">1. 🏬 Browse Deals by Brand</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">🏬</span>Brands are sorted by discount and ⏳ expiration time.</li>
        <li><span class="icon">⭐</span> <strong>Featured Brand:</strong> Automatically open when you launch the app.</li>
         <li><span class="icon">🌟</span> <strong>Top 5 Brands:</strong>  Brands pick to be on top.</li>
        <li><span class="icon">🔥</span> <strong>Hottest Discount:</strong> Top discounts across all brands.</li>
        <li><span class="icon">🚫</span>No deals available right now. Means check back later.</li>
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">2. 🏷️ Brand Recognition Guide</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">🏆</span> <strong>Elite Brand</strong> </li>
        <li><span class="icon">👑</span> <strong>Pro Brand</strong> </li>
        <li><span class="icon">💎</span> <strong>Premium Brand</strong> </li>
        <li><span class="icon">🎁</span> <strong>Starter Brand</strong></li>
        
        
        
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">3. 🏆 Elite Brand</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">💥</span> <strong>Exclusive Brand:</strong> They are the only deals in the system.</li>
        <li><span class="icon">👆</span> <strong>During Exclusive:</strong> Click Show All Other Brands to reveal the others.</li>
        </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">4. 🔍 View Deal Details</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">👆</span>Click on any deal to see price, cashback, and expiration.</li>
        <li><span class="icon">⬆️⬇️</span>Swipe up or down to move between deals.</li>
        <li><span class="icon">➖</span>Tap on the tabs to switch between mode.</li>
        <li><span class="icon">📝</span> Add deals to your cart.</li>
        <li><span class="icon">❌</span> Delete deals from your cart.</li>
         <li><span class="icon">❤️</span>Tap the heart icon to likes deals you like.</li>
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">5. ❤️ Likes Deals</div>
    <div class="accordion-content">
      <ul>
       <li><span class="icon">❤️</span>Likes deals auto-load at the top for quick access.</li>
        <li><span class="icon">👆</span>Click on any liked deals to view all liked deals.</li>
        
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">6. 🛒 Shopping Cart</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">💵</span>See subtotals, tax, and grand totals by brand.</li>
        <li><span class="icon">📃</span>Clear brand-specific all items from your cart.</li>
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">7. 💾 Save Shopping List</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">📃</span> Save your current shopping list for later reference.</li>
        <li><span class="icon">📅</span> Lists are saved by brand with date and items included.</li>
        <li><span class="icon">📂</span> You can open saved lists anytime to review them quickly.</li>
      </ul>
    </div>
  </div>
	
  <div class="accordion">
    <div class="accordion-header">8. 📍 Store Locations</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">📍</span>Click <strong>Location</strong> to get stores directions.</li>
        <li><span class="icon">📉</span>Enable location access to get directions in Google Maps.</li>
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">9. 🧪 Tips & Tricks</div>
    <div class="accordion-content">
      <ul>
        
        <li><span class="icon">👆</span>Click to open and close brands grid to reshuffle deals.</li>
        <li><span class="icon">⏳</span>Keep an eye on timers, some expire quickly.</li>
       
      </ul>
    </div>
  </div>

  <div class="accordion">
    <div class="accordion-header">10. ❓ Troubleshooting</div>
    <div class="accordion-content">
      <ul>
        <li><span class="icon">🔄</span>Refresh the page if deals don’t load.</li>
        <li><span class="icon">🚫</span>Check your internet connection.</li>
        <li><span class="icon">📍</span>Enable location access for maps and directions.</li>
        <li><span class="icon">🔧</span>Clearing browser data removes saved favorites and cart.</li>
        <li><span class="icon">📧</span>Need help? <strong>just message us on WhatsApp</strong></li>
      </ul>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('.accordion-header').forEach(header => {
    header.addEventListener('click', () => {
      const currentlyActive = document.querySelector('.accordion-header.active');
      if (currentlyActive && currentlyActive !== header) {
        currentlyActive.classList.remove('active');
        currentlyActive.nextElementSibling.style.display = 'none';
      }

      header.classList.toggle('active');
      const content = header.nextElementSibling;
      content.style.display = header.classList.contains('active') ? 'block' : 'none';
    });
  });
</script>	  
  </div>
</div>

<!-- Leaderboard Popup -->
<div id="leaderboardPopup" class="popup">
  <button onclick="closeLeaderboard()" class="close-button" aria-label="Close leaderboard popup">&times;</button>
  <h2>🎯 Referral Challenge</h2>
	
  <div class="leaderboard-tabs">
    <div class="leaderboard-tab" onclick="showTab('sponsorTab', this)">⭐ Sponsor</div>
    <div class="leaderboard-tab" onclick="showTab('leaderboardTab', this)">🏆 Leaderboard</div>
    <div class="leaderboard-tab" onclick="showTab('winnersTab', this)">🎉 Winners</div>
  </div>

<div class="tab-content" id="sponsorTab" style="display: none;"> 
  <div id="sponsorContent"> <center> <h3 style="margin-bottom: 10px;">No Sponsor Right Now</h3>
    <p>Check back soon for your chance to win exclusive vouchers from top brands.</p>
    <p>🔥 Exciting giveaways and offers are always around the corner!</p> </center></div> 
</div>
	
  <div class="tab-content" id="leaderboardTab" style="display: none;">
    <div id="leaderboardContent">Loading leaderboard...</div>
  </div>

  <div class="tab-content" id="winnersTab" style="display: none;">
    <div id="winnersContent">Loading past winners...</div>
  </div>
</div>



				  
		  
 <!-- Popup Overlay -->
<div class="popup-overlay" id="popup">

<div class="tab-switcher">
  <button id="showLikedBtn" class="tab-btn">Likes</button>
  <button id="showRandomBtn" class="tab-btn active">Deals</button>
  <button id="showBrandTabBtn" class="tab-btn">Shop</button>
 <button id="cartBtn" class="tab-btn">
  <span class="cart-icon2">🛒</span>
  <span id="cartCount" class="cart-count2">0</span>
</button>
</div>

	
  <div class="popup-content" id="popupContent">
    <span class="popup-close" onclick="closePopup()">×</span>
    <div style="position: relative;">
      <span class="popup-discount-badge" id="popupBadge"></span>
	    
      <button id="popupBack" class="popup-back-arrow"></button> 
     <div class="image-wrapper">
      <img id="popupImg" src="" alt="Product">
    </div>
	   <div id="cartBtnContainer" class="hidden">
	    <button id="popupAddToCartBtn" class="cart-btn">🛒 Add</button>
	    </div>
	   <div id="likeButtonContainer">
  <button class="like-btn" id="popupLikeBtn">🤍 Like</button>
</div>

    </div>
    <div class="popup-body">
      <div class="popup-title" id="popupTitle"></div>
      <div class="popup-price" id="popupPrice"></div>
      <div class="popup-discount" id="popupDiscount"></div>
      <div class="popup-savings" id="popupSavings"></div> <!-- Savings element below the discount -->
      <div id="popupCashback" class="popup-cashback"></div>
      <div class="popup-description" id="popupDesc"></div>
     
    </div>	  
  </div> 

 <!-- Brand Box Wrapper -->
<div class="popup-brand-box" id="brandContainer">
  <div class="brand-logo-container">
    <img id="brandLogo" src="" alt="Brand Logo" class="brand-logo">
  </div>

	<div class="brand-text-container">
    <div id="brandName" class="brand-name"></div>
    <span id="popupTimer" class="brand-timer"></span>
  </div>
  
</div>
	
</div> 





<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
  const sheetURL = 'https://opensheet.elk.sh/1_DyGLoYi5ndEkiwhPEzJhMc3vciIFNhN2g-H0gbVRds/sheet7';
  let storyMap = {};
  let sequenceRanges = [];
  let swiper;
  let isJumping = false;

  async function loadStories() {
  const res = await fetch(sheetURL);
  const data = await res.json();

  sequenceRanges = [];
  storyMap = {}; // reset

  let currentSequence = '';
  let currentStartIndex = 0;

  data.forEach((story, index) => {
    // Detect new sequence start
    if (parseInt(story['Slide #']) === 1 && story['Story Title']) {
      if (currentSequence) {
        sequenceRanges.push({ title: currentSequence, start: currentStartIndex, end: index - 1 });
      }
      currentSequence = story['Story Title'].trim();
      currentStartIndex = index;
    }

    // Map every slide title (e.g., headline) to its index for jumps
    if (parseInt(story['Slide #']) === 1 && story['Story Title']) {
  const normalizedTitle = story['Story Title'].trim().toLowerCase();
  if (!(normalizedTitle in storyMap)) {
    storyMap[normalizedTitle] = index;
  }
}

  });
   
  if (currentSequence) {
    sequenceRanges.push({ title: currentSequence, start: currentStartIndex, end: data.length - 1 });
  }

    // Build slidesData array
    window.slidesData = data
      .map((story, index) => {
        if (!story['Image URL']) return null;

        let sequenceName = '';
        for (let seq of sequenceRanges) {
          if (index >= seq.start && index <= seq.end) {
            sequenceName = seq.title;
            break;
          }
        }

        return {
          index,
          sequence: sequenceName,
          image: story['Image URL'],
          title: (parseInt(story['Slide #']) === 1 && story['Story Title']) ? story['Story Title'] : story['Title'],
          description: story['Description'],
          ctaText: story['CTA Text'],
          ctaLink: story['CTA Link'],
          ctaText2: story['CTA Text 2'],
          storyJump: story['Story Jump'],
          sponsored: story['Sponsored'],
          brandLogo: story['Brand Logo'],
        };
      })
      .filter(Boolean);

    showStoryList();
  }

  function groupSlidesBySequence(slides) {
    const sequences = {};
    slides.forEach(slide => {
      if (!sequences[slide.sequence]) sequences[slide.sequence] = [];
      sequences[slide.sequence].push(slide);
    });
    return sequences;
  }

  function renderSlides(slides) {
    const wrapper = document.getElementById('storyWrapper');
    wrapper.innerHTML = '';

    slides.forEach((story, i) => {
      const slide = document.createElement('div');
      slide.className = 'swiper-slide';
      slide.style.backgroundImage = `url(${story.image})`;

      slide.dataset.index = story.globalIndex ?? i;
     
      const overlay = document.createElement('div');
      overlay.className = 'slide-overlay';

      // Big headline for first slide in sequence (Slide # 1)
      if (parseInt(story.index) === slides[0].index) {
        slide.classList.add('headline-slide');
        const title = document.createElement('div');
        title.className = 'slide-title';
        title.textContent = story.title;
        overlay.appendChild(title);
      } else if (story.title) {
        const title = document.createElement('div');
        title.className = 'slide-title';
        title.textContent = story.title;
        overlay.appendChild(title);
      }

      if (story.description) {
        const desc = document.createElement('div');
        desc.className = 'slide-desc';
        desc.textContent = story.description;
        overlay.appendChild(desc);
      }

      const ctaContainer = document.createElement('div');
      ctaContainer.className = 'cta-container';

      if (story.ctaText && story.ctaLink) {
        const linkBtn = document.createElement('a');
        linkBtn.className = 'cta-button cta-link-button';
        linkBtn.href = story.ctaLink;
        linkBtn.target = '_blank';
        linkBtn.textContent = story.ctaText;
        linkBtn.addEventListener('click', e => e.stopPropagation());
        ctaContainer.appendChild(linkBtn);
      }

   if (story.ctaText2 && story.storyJump) {
  const jumpBtn = document.createElement('button');
  jumpBtn.className = 'cta-button cta-jump-button';
  jumpBtn.textContent = story.ctaText2;

  jumpBtn.addEventListener('click', e => {
  e.stopPropagation();

  if (isJumping) return; // avoid double-tap issues
  isJumping = true; // lock early

  const jumpTitle = story.storyJump.trim().toLowerCase();
  const jumpIndex = storyMap[jumpTitle];

  if (jumpIndex !== undefined) {
    const jumpSlide = window.slidesData[jumpIndex];
    const jumpSequence = jumpSlide.sequence;

    const sequences = groupSlidesBySequence(window.slidesData || []);
    const slidesInSequence = sequences[jumpSequence] || [];
    const localIndex = slidesInSequence.findIndex(slide => slide.index == jumpIndex);

    if (localIndex !== -1) {
      openStorySequence(jumpSequence, localIndex); // will handle isJumping reset
    } else {
      console.warn('Jump target found globally, but not within sequence:', jumpSequence);
      isJumping = false;
    }

  } else {
    console.warn('Jump target not found:', story.storyJump);
    console.log('Available titles:', Object.keys(storyMap));
    isJumping = false;
  }
});


 const closeBtn = document.createElement('button');
closeBtn.className = 'cta-button cta-close-button';
closeBtn.textContent = 'Close'; // Or 'Close'
closeBtn.addEventListener('click', e => {
  e.stopPropagation();
  closeStoryViewer();
});
  ctaContainer.appendChild(jumpBtn);
  ctaContainer.appendChild(closeBtn);
}
      if (ctaContainer.childElementCount > 0) {
        overlay.appendChild(ctaContainer);
      }

      if (story.sponsored && story.sponsored.toLowerCase() === 'true') {
        const label = document.createElement('div');
        label.className = 'sponsored-label';
        label.textContent = 'Sponsored';
        slide.appendChild(label);
      }

      if (story.brandLogo) {
        const logo = document.createElement('img');
        logo.className = 'brand-logo';
        logo.src = story.brandLogo;
        logo.alt = 'Logo';
        slide.appendChild(logo);
      }

      slide.appendChild(overlay);
      wrapper.appendChild(slide);
    });
  }

function closeStoryViewer() {
  if (isJumping) return; // Prevent closing during a jump transition

  const swiperContainer = document.querySelector('.swiper');
  const storyList = document.getElementById('storyListContainer');
  const viewAllBtn = document.getElementById('viewAllButton');

  if (swiperContainer) {
    swiperContainer.style.display = 'none'; // Hide swiper
  }

  if (swiper) {
    swiper.destroy(true, true);
    swiper = null;
  }

  if (storyList) {
    storyList.style.display = 'grid'; // Show story grid
  }

  if (viewAllBtn) {
    viewAllBtn.style.display = 'inline-block'; // Show 'View All' button
  }

  document.body.classList.remove('popup-open');
}


  function initSwiper() {
    if (swiper) swiper.destroy(true, true);

    swiper = new Swiper('.swiper', {
      direction: 'horizontal',
      slidesPerView: 1,
      allowTouchMove: false,
      watchSlidesProgress: true,
      observer: true,
      observeParents: true,
    });

    swiper.on('slideChangeTransitionEnd', () => {
      updateProgress(swiper.activeIndex);
    });

    // Tap zones for navigation
    document.getElementById('tapLeft').onclick = () => swiper.slidePrev();
    document.getElementById('tapRight').onclick = () => swiper.slideNext();
  }

  function updateProgress(index) {
  const progressBar = document.getElementById('progressBar');
  if (!swiper || !progressBar) return;

  const total = swiper.slides.length;

  progressBar.innerHTML = ''; // Clear previous segments

  for (let i = 0; i < total; i++) {
    const seg = document.createElement('div');
    seg.className = 'progress-segment';

    const fill = document.createElement('div');
    fill.className = 'progress-fill';

    if (i < index) {
      fill.style.width = '100%';
    } else if (i === index) {
      fill.style.width = '0%';
      fill.style.transition = 'width 5s linear'; // match to slide duration if autoplay
      requestAnimationFrame(() => {
        fill.style.width = '100%';
      });
    }

    seg.appendChild(fill);
    progressBar.appendChild(seg);
  }
}
  
function renderStoryTiles() {
  const container = document.getElementById('storyListContainer');
  container.innerHTML = '';

  const sequences = groupSlidesBySequence(window.slidesData || []);
  Object.keys(sequences).forEach(seqKey => {
    const firstSlide = sequences[seqKey][0];
    const tile = document.createElement('div');
    tile.className = 'story-tile';
    tile.onclick = () => {
      openStorySequence(seqKey);
    };
    tile.innerHTML = `
      <img src="${firstSlide.image || ''}" alt="Story preview">
      <h3>${firstSlide.title || 'Untitled'}</h3>
    `;
    container.appendChild(tile);
  });
}


 function openStorySequence(sequenceKey, startIndex = 0) {
  const sequences = groupSlidesBySequence(window.slidesData || []);
  const sequenceSlides = sequences[sequenceKey];
  if (!sequenceSlides) {
    isJumping = false;
    return;
  }

  const swiperContainer = document.querySelector('.swiper');
  if (swiperContainer) {
    swiperContainer.style.display = 'block';
  }

  renderSlides(sequenceSlides);


   setTimeout(() => {
  if (!swiper) {
    initSwiper();
  } else {
    swiper.update();  // <-- refresh swiper to sync with new slides
  }

  swiper.slideTo(startIndex);
  updateProgress(startIndex);

  setTimeout(() => {
    isJumping = false;
  }, 300);
}, 50);
 }  
  /* setTimeout(() => {
    if (!swiper) initSwiper();
    swiper.slideTo(startIndex);
    updateProgress(startIndex);

    // Only unlock after full transition + render
    setTimeout(() => {
      isJumping = false;
    }, 300); // may adjust this if your init is slow
  }, 50);
}*/

function showStoryList() {
  if (!window.slidesData) {
    loadStories().then(actuallyShowTiles);
  } else {
    actuallyShowTiles();
  }

  function actuallyShowTiles() {
    document.getElementById('storyListPopup').style.display = 'flex';
    renderStoryTiles();
  }
}

function closeStoryListPopup() {
  document.getElementById('storyListPopup').style.display = 'none';
}

// Listeners
document.getElementById('viewAllButton').addEventListener('click', showStoryList);
document.getElementById('closeStoryListPopupBtn').addEventListener('click', closeStoryListPopup);


</script>

 
