
<style>
  body {
  font-family: Arial, sans-serif;
  background-color: #f9f9f9;
  text-align: center;
}

.flyer {
  margin: 0px auto;
  display: inline-block;
  
	
}

.flyer-wrapper {
  position: relative;
  display: inline-block;
	
}

.flyer-img {
  width: 100%;
  height: auto;
  border-radius: 0;
}

.code-overlay {
  position: absolute;
  top: 73%; /* adjust per flyer */
  left: 24%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.8);
  padding: 0px 16px;
  border-radius: 0px;
  font-weight: bold;
  font-size: 1.0em;
  white-space: nowrap;
}

.code-overlay2 {
  position: absolute;
  top: 80.8%; /* adjust per flyer */
  left: 70%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.8);
  padding: 0px 16px;
  border-radius: 0px;
  font-weight: bold;
  font-size: 1.3em;
  white-space: nowrap;
}


	
.download-btn {
  margin-top: 10px;
  padding: 8px 16px;
  font-size: 1em;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.download-btn:hover {
  background-color: #0056b3;
}

form {
  margin-top: 20px;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

input {
  padding: 8px;
  margin-top: 10px;
  width: 200px;
  font-size: 1em;
  border-radius: 5px;
  border: 1px solid #ccc;
}

button {
  padding: 10px 20px;
  margin-top: 10px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background-color: #218838;
}

  </style>


  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

 <hr>
<!-- Hidden until referral code is generated -->
 <div class="flyer" style="display:none;" id="flyer1">
  <div class="flyer-wrapper">
    <img src="https://www.allpree.com/img/ad1.png" alt="Flyer 1" class="flyer-img" />
    <div class="code-overlay" id="flyer1Code"></div>
  </div>
  <button class="download-btn" onclick="downloadFlyer('flyer1')" style="display:none;">Download Flyer</button>
</div> 
   <hr>
<div class="flyer" style="display:none;" id="flyer2">
  <div class="flyer-wrapper">
    <img src="https://www.allpree.com/img/ad2.png" alt="Flyer 2" class="flyer-img" />
    <div class="code-overlay2" id="flyer2Code"></div>
  </div>
  <button class="download-btn" onclick="downloadFlyer('flyer2')" style="display:none;">Download Flyer</button>
</div>
   <hr>
 <div class="flyer" style="display:none;" id="flyer3">
  <div class="flyer-wrapper">
    <img src="https://www.allpree.com/img/ad1.png" alt="Flyer 3" class="flyer-img" />
    <div class="code-overlay" id="flyer3Code"></div>
  </div>
</div>
<center>  <button class="download-btn" onclick="downloadFlyer('card')" style="display:none;">Download Flyer</button></center> 
			
<!-- Referral Code Form -->
<form id="referralForm">
  Still working on this but you can test it out for now <br>
  <label for="referralCode">Enter Your Referral Code:</label>
  <input type="text" id="referralCode" name="referralCode" required>
  <button type="submit">Generate Flyers</button>
</form>

<hr>		

 <p id="referralText" style="display: none;">Use my referral code ${savedReferralCode} to get started!</p>
                  <hr>
<a id="referralTextLink" style="display: none;" href="https://wa.me/?text=Check%20out%20my%20referral%20code%20${savedReferralCode}%20to%20get%20started!" target="_blank">
  Share on WhatsApp
</a>
   <hr>



    <center>   <button id="referralBtn" class="btn btn-outline btn-xla" data-url="https://wa.me/?text=Check%20out%20my%20referral%20code%20${encodeURIComponent(formattedCode)}%20to%20get%20started!" style="display: none;" target="_blank">   <i class="fa-solid fa-computer-mouse"></i> send Whatsapp Msg </button> 
     </center> 

<br><br>
			
<script>
function formatReferralCode(code) {
  return code.replace(/\s+/g, ''); // Remove spaces without adding any dashes
}

// Function to check if the stored code has expired
function isCodeExpired() {
  const expirationDate = localStorage.getItem('referralCodeExpiration');
  if (expirationDate) {
    const currentTime = Date.now();
    return currentTime > parseInt(expirationDate);
  }
  return true; // If no expiration date is set, consider it expired
}

function updateFlyersWithCode(code) {
  const formattedCode = formatReferralCode(code);

  // Save the formatted code and set expiration time in localStorage
  localStorage.setItem('generatedReferralCode', formattedCode);
  
  // Set expiration date for 7 days from now
  const expirationTime = Date.now() + (7 * 24 * 60 * 60 * 1000); // 7 days in milliseconds
  localStorage.setItem('referralCodeExpiration', expirationTime);

  // Update the referral code for each flyer
  document.getElementById("flyer1Code").textContent = formattedCode;
  document.getElementById("flyer2Code").textContent = formattedCode;
  document.getElementById("flyer3Code").textContent = formattedCode;

  // Show the download button after code is generated
  document.querySelectorAll(".download-btn").forEach(btn => btn.style.display = "inline-block");

  // Show the flyers and hide the form
  document.getElementById("flyer1").style.display = "inline-block";
  document.getElementById("flyer2").style.display = "inline-block";
  document.getElementById("flyer3").style.display = "inline-block";
  document.getElementById("referralForm").style.display = "none";

  // Display the referral code and WhatsApp link
  document.getElementById("referralText").style.display = "block";  // Show referral text
  document.getElementById("referralTextLink").style.display = "block";  // Show WhatsApp link

  // Replace the referral code in the text and link with the formatted code
  const textElement = document.getElementById('referralText');
  const linkElement = document.getElementById('referralTextLink');
  
  // Replace in the visible text
  textElement.innerHTML = textElement.innerHTML.replace('${savedReferralCode}', formattedCode);
  
  // Replace in the link href
  linkElement.href = linkElement.href.replace('${savedReferralCode}', encodeURIComponent(formattedCode));

  // ✅ Handle referral button
  const btnElement = document.getElementById('referralBtn');
  if (btnElement) {
    btnElement.style.display = "inline-block";
    const rawUrl = btnElement.getAttribute('data-url');
    const finalUrl = rawUrl.replace('${encodeURIComponent(formattedCode)}', encodeURIComponent(formattedCode));
    btnElement.onclick = () => {
      window.open(finalUrl, '_blank');
    };
  }
}

function downloadFlyer(flyerId) {
  const flyer = document.querySelector(`#${flyerId} .flyer-wrapper`);
  html2canvas(flyer, { scale: 2 }).then(canvas => {
    const link = document.createElement('a');
    link.download = `${flyerId}-flyer.png`;
    link.href = canvas.toDataURL();
    link.click();
  });
}

// Handle form submission
document.getElementById("referralForm").addEventListener("submit", function(event) {
  event.preventDefault();
  
  const referralCode = document.getElementById("referralCode").value.trim();
  
  if (referralCode) {
    updateFlyersWithCode(referralCode); // Update flyers with the code
  }
});

// On page load, check if a referral code is saved and if it has expired
window.addEventListener('DOMContentLoaded', () => {
  const savedReferralCode = localStorage.getItem('generatedReferralCode');
  
  if (savedReferralCode && !isCodeExpired()) {
    updateFlyersWithCode(savedReferralCode); // Show saved referral code and flyers

    // Replace the referral code in the text and link
    const textElement = document.getElementById('referralText');
    const linkElement = document.getElementById('referralTextLink');
    
    // Replace in the visible text
    textElement.innerHTML = textElement.innerHTML.replace('${savedReferralCode}', savedReferralCode);
    
    // Replace in the link href
    linkElement.href = linkElement.href.replace('${savedReferralCode}', encodeURIComponent(savedReferralCode));
    
    // Display the referral text and link immediately after replacement
    textElement.style.display = "block";
    linkElement.style.display = "block";

    // ✅ Handle referral button on page load
    const btnElement = document.getElementById('referralBtn');
    if (btnElement) {
      btnElement.style.display = "inline-block";
      const rawUrl = btnElement.getAttribute('data-url');
      const finalUrl = rawUrl.replace('${encodeURIComponent(formattedCode)}', encodeURIComponent(savedReferralCode));
      btnElement.onclick = () => {
        window.open(finalUrl, '_blank');
      };
    }
  } else {
    // Code has expired or doesn't exist, show the form
    document.getElementById("referralForm").style.display = "block";
    document.getElementById("flyer1").style.display = "none";
    document.getElementById("flyer2").style.display = "none";
    document.getElementById("flyer3").style.display = "none";
  }
});
</script>
