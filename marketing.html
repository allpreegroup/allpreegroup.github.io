<!DOCTYPE html>
<html lang="en">
    <html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <link rel="stylesheet" href="https://www.allpree.com/css/main.css">
 <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"> 
 <link href="//site-assets.fontawesome.com/releases/v6.1.1/css/all.css" rel="stylesheet"> 
<link href="//fonts.googleapis.com/css?family=Space+Mono|Work+Sans:700" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">	

    <meta charset="UTF-8">
      <title>Referral Flyer</title>
<head>

<style>
  body {
  font-family: Arial, sans-serif;
  background-color: #f9f9f9;
  text-align: center;
}

.flyer {
  margin: 0px auto;
  display: inline-block;
  
	
}

.flyer-wrapper {
  position: relative;
  display: inline-block;
	
}

.flyer-img {
  width: 100%;
  height: auto;
  border-radius: 0;
}

.code-overlay {
  position: absolute;
  top: 73%; /* adjust per flyer */
  left: 24%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.8);
  padding: 0px 16px;
  border-radius: 0px;
  font-weight: bold;
  font-size: 1.0em;
  white-space: nowrap;
}

.download-btn {
  margin-top: 10px;
  padding: 8px 16px;
  font-size: 1em;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.download-btn:hover {
  background-color: #0056b3;
}

form {
  margin-top: 20px;
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

input {
  padding: 8px;
  margin-top: 10px;
  width: 200px;
  font-size: 1em;
  border-radius: 5px;
  border: 1px solid #ccc;
}

button {
  padding: 10px 20px;
  margin-top: 10px;
  background-color: #28a745;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background-color: #218838;
}

  </style>

	

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>
<body>
<!-- start webpushr tracking code --> 
<script>(function(w,d, s, id) {if(typeof(w.webpushr)!=='undefined') return;w.webpushr=w.webpushr||function(){(w.webpushr.q=w.webpushr.q||[]).push(arguments)};var js, fjs = d.getElementsByTagName(s)[0];js = d.createElement(s); js.id = id;js.async=1;js.src = "https://cdn.webpushr.com/app.min.js";
fjs.parentNode.appendChild(js);}(window,document, 'script', 'webpushr-jssdk'));
webpushr('setup',{'key':'BE2GVRF5mLk7Fp1kzgXE_A5QDGK54HwqN1wEgxczP_fzfugkPREKHebr_Bfzd13eEyrn2rpv_IxZ-H9A4rygXPA' });</script>
<!-- end webpushr tracking code -->



<!-- Fullscreen Overlay -->
 <div id="fullscreenOverlay" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:#fff; z-index:9999; overflow:auto;">
   <button onclick="smartBack()" style="
     position:absolute;
     top:15px;
     right:15px;
     z-index:10000;
     background:#000;
     color:#fff;
     border:none;
     padding:10px 15px;
     font-size:16px;
     border-radius:8px;
   ">âœ• Close</button>
 
   <div id="menuContent" style="padding:20px;"></div>
 </div>
 
 <script>
 function loadMenu() {
   fetch('https://www.allpree.com/menu/')
     .then(response => response.text())
     .then(html => {
       document.getElementById('menuContent').innerHTML = html;
       document.getElementById('fullscreenOverlay').style.display = 'block';
     })
     .catch(err => {
       alert("Failed to load menu.");
       console.error(err);
     });
 }
 
 function smartBack(fallbackUrl = '/balance') {
   const previous = document.referrer;
 
   if (previous && previous !== window.location.href) {
     window.location.href = previous;
   } else {
     window.location.href = fallbackUrl;
   }
 }
 
 </script>


<nav id="mainNav" class="navbar navbar-default navbar-fixed-top">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <a href="#" onclick="loadMenu(); return false;">   <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span> Menu <i class="fa-solid fa-bars"></i>
                </button> 

             </a>
               

           <!--  <a class="navbar-brand page-scroll" href="https://twitter.com/allpreedotcom"><i class="fa-brands fa-twitter"></i></a>
             <a class="navbar-brand page-scroll" href="https://instagram.com/allpreedotcom"><i class="fa-brands fa-instagram"></i></a>
             <a class="navbar-brand page-scroll" href="https://facebook.com/allpreedotcom"><i class="fa-brands fa-facebook"></i></a> -->
             
             <!--    <a class="navbar-brand page-scroll" onclick="history.back()"><i class="fa-solid fa-backward"></i></a>  
             <a class="navbar-brand page-scroll" href="https://www.allpree.com/" >CashBack</a> -->

             
            <a class="navbar-brand page-scroll" href="https://www.allpree.com/contact"><strong><i class="fa-solid fa-user-plus fa-lg"></i></strong> Sign Up</a>
             <a class="navbar-brand page-scroll" href="https://www.allpree.com/storeapp" ><strong><i class="fa-solid fa-shop"></i></strong> Brands</a>
              
	     <!--      <a class="navbar-brand page-scroll" href="https://www.allpree.com/balance" >Balance</a>
             <a class="navbar-brand page-scroll" href="https://www.allpree.com/vouchers"><strong>Bufa-solid fa-housey eVoucher</strong></a>
              <a class="navbar-brand page-scroll" href="https://www.allpree.com/invite" >Earn</a>
              <a class="navbar-brand page-scroll" href="https://www.allpree.com/balance"><strong><i class="fa-solid fa-house"></i> HOME</strong></a>
               
            <!--   <a class="navbar-brand page-scroll" href="https://www.allpree.com/join" >Msg HR</a> -->

              
             
            <!--   <a class="navbar-brand page-scroll" href="https://www.snapchat.com/add/allpreedotcom"><i class="fa-brands fa-snapchat"></i>&nbsp;</a>
             
              <a class="navbar-brand page-scroll" href="https://tiktok.com/@joinwatsapp"><i class="fa-brands fa-tiktok"></i>&nbsp;</a>
             
              <a class="navbar-brand page-scroll">&nbsp;<strong>EVERY Day Is Black Friday!</strong></a>  
      <a class="navbar-brand page-scroll">&nbsp;<strong>Allpree Plus <i class="fa-solid fa-location-plus"></i></strong></a>
             <a class="navbar-brand page-scroll" href=""><strong><i class="fa-brands fa-whatsapp"></i> eCom <i class="fa-brands fa-btc"></i></strong> - Semi Done For You </a> 
             	  <a class="navbar-brand page-scroll" href=""><i class="fa-solid fa-sack-dollar"></i>&nbsp;Investors</a>
              <a class="navbar-brand page-scroll" href=""><i class="fa-solid fa-sack-dollar"></i>&nbsp;Resellers</a>
             <a class="navbar-brand page-scroll" href=""><i class="fa-solid fa-sack-dollar"></i>&nbsp;Referrals</a> 
               -->
              
             
             
            </div>

            <!-- Collect the nav links, forms, and other content for toggling &nbsp; -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <!--  <ul class="nav navbar-nav navbar-right">
                <li>
                   <a class="page-scroll" href="https://www.allpree.com/referral-program" >Refer & Earn</a>
                    </li>
                    <li>
                   <a class="page-scroll" href="https://www.allpree.com/list/">All Stores</a>
                    </li>
                    <li>
                  <a class="page-scroll" href="https://www.allpree.com/balance/"><strong>Check Balance</strong></a> 
                    </li> 
                </ul> -->
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container-fluid -->
    </nav>

	<div class="container">
            <div class="row land">
                <div class="home">     
			<div class="center">
                <div class="col-md-6 home-txt1"> <br><br>
<hr>
<!-- Hidden until referral code is generated -->
<div class="flyer" style="display:none;" id="flyer1">
  <div class="flyer-wrapper">
    <img src="https://www.allpree.com/img/ad1.png" alt="Flyer 1" class="flyer-img" />
    <div class="code-overlay" id="flyer1Code"></div>
  </div>
  <button class="download-btn" onclick="downloadFlyer('flyer1')" style="display:none;">Download Flyer</button>
</div>
   <hr>
<div class="flyer" style="display:none;" id="flyer2">
  <div class="flyer-wrapper">
    <img src="https://www.allpree.com/img/ad2.png" alt="Flyer 2" class="flyer-img" />
    <div class="code-overlay" id="flyer2Code"></div>
  </div>
  <button class="download-btn" onclick="downloadFlyer('flyer2')" style="display:none;">Download Flyer</button>
</div>
   <hr>
<div class="flyer" style="display:none;" id="flyer3">
  <div class="flyer-wrapper">
    <img src="https://www.allpree.com/img/ad1.png" alt="Flyer 3" class="flyer-img" />
    <div class="code-overlay" id="flyer3Code"></div>
  </div>
</div>
<center>  <button class="download-btn" onclick="downloadFlyer('card')" style="display:none;">Download Flyer</button></center>
			
<!-- Referral Code Form -->
<form id="referralForm">
  Still working on this but you can test it out for now <br>
  <label for="referralCode">Enter Your Referral Code:</label>
  <input type="text" id="referralCode" name="referralCode" required>
  <button type="submit">Generate Flyers</button>
</form>

<hr>		

<p id="referralText" style="display: none;">Use my referral code ${savedReferralCode} to get started!</p>
                  <hr>
<a id="referralTextLink" style="display: none;" href="https://wa.me/?text=Check%20out%20my%20referral%20code%20${savedReferralCode}%20to%20get%20started!" target="_blank">
  Share on WhatsApp
</a>
   <hr>



    <center>   <button id="referralBtn" class="btn btn-outline btn-xla" data-url="https://wa.me/?text=Check%20out%20my%20referral%20code%20${encodeURIComponent(formattedCode)}%20to%20get%20started!" style="display: none;" target="_blank">   <i class="fa-solid fa-computer-mouse"></i> send Whatsapp Msg </button> 
     </center>

<br><br>
			
<script>
function formatReferralCode(code) {
  return code.replace(/\s+/g, ''); // Remove spaces without adding any dashes
}

// Function to check if the stored code has expired
function isCodeExpired() {
  const expirationDate = localStorage.getItem('referralCodeExpiration');
  if (expirationDate) {
    const currentTime = Date.now();
    return currentTime > parseInt(expirationDate);
  }
  return true; // If no expiration date is set, consider it expired
}

function updateFlyersWithCode(code) {
  const formattedCode = formatReferralCode(code);

  // Save the formatted code and set expiration time in localStorage
  localStorage.setItem('generatedReferralCode', formattedCode);
  
  // Set expiration date for 7 days from now
  const expirationTime = Date.now() + (7 * 24 * 60 * 60 * 1000); // 7 days in milliseconds
  localStorage.setItem('referralCodeExpiration', expirationTime);

  // Update the referral code for each flyer
  document.getElementById("flyer1Code").textContent = formattedCode;
  document.getElementById("flyer2Code").textContent = formattedCode;
  document.getElementById("flyer3Code").textContent = formattedCode;

  // Show the download button after code is generated
  document.querySelectorAll(".download-btn").forEach(btn => btn.style.display = "inline-block");

  // Show the flyers and hide the form
  document.getElementById("flyer1").style.display = "inline-block";
  document.getElementById("flyer2").style.display = "inline-block";
  document.getElementById("flyer3").style.display = "inline-block";
  document.getElementById("referralForm").style.display = "none";

  // Display the referral code and WhatsApp link
  document.getElementById("referralText").style.display = "block";  // Show referral text
  document.getElementById("referralTextLink").style.display = "block";  // Show WhatsApp link

  // Replace the referral code in the text and link with the formatted code
  const textElement = document.getElementById('referralText');
  const linkElement = document.getElementById('referralTextLink');
  
  // Replace in the visible text
  textElement.innerHTML = textElement.innerHTML.replace('${savedReferralCode}', formattedCode);
  
  // Replace in the link href
  linkElement.href = linkElement.href.replace('${savedReferralCode}', encodeURIComponent(formattedCode));

  // âœ… Handle referral button
  const btnElement = document.getElementById('referralBtn');
  if (btnElement) {
    btnElement.style.display = "inline-block";
    const rawUrl = btnElement.getAttribute('data-url');
    const finalUrl = rawUrl.replace('${encodeURIComponent(formattedCode)}', encodeURIComponent(formattedCode));
    btnElement.onclick = () => {
      window.open(finalUrl, '_blank');
    };
  }
}

function downloadFlyer(flyerId) {
  const flyer = document.querySelector(`#${flyerId} .flyer-wrapper`);
  html2canvas(flyer, { scale: 2 }).then(canvas => {
    const link = document.createElement('a');
    link.download = `${flyerId}-flyer.png`;
    link.href = canvas.toDataURL();
    link.click();
  });
}

// Handle form submission
document.getElementById("referralForm").addEventListener("submit", function(event) {
  event.preventDefault();
  
  const referralCode = document.getElementById("referralCode").value.trim();
  
  if (referralCode) {
    updateFlyersWithCode(referralCode); // Update flyers with the code
  }
});

// On page load, check if a referral code is saved and if it has expired
window.addEventListener('DOMContentLoaded', () => {
  const savedReferralCode = localStorage.getItem('generatedReferralCode');
  
  if (savedReferralCode && !isCodeExpired()) {
    updateFlyersWithCode(savedReferralCode); // Show saved referral code and flyers

    // Replace the referral code in the text and link
    const textElement = document.getElementById('referralText');
    const linkElement = document.getElementById('referralTextLink');
    
    // Replace in the visible text
    textElement.innerHTML = textElement.innerHTML.replace('${savedReferralCode}', savedReferralCode);
    
    // Replace in the link href
    linkElement.href = linkElement.href.replace('${savedReferralCode}', encodeURIComponent(savedReferralCode));
    
    // Display the referral text and link immediately after replacement
    textElement.style.display = "block";
    linkElement.style.display = "block";

    // âœ… Handle referral button on page load
    const btnElement = document.getElementById('referralBtn');
    if (btnElement) {
      btnElement.style.display = "inline-block";
      const rawUrl = btnElement.getAttribute('data-url');
      const finalUrl = rawUrl.replace('${encodeURIComponent(formattedCode)}', encodeURIComponent(savedReferralCode));
      btnElement.onclick = () => {
        window.open(finalUrl, '_blank');
      };
    }
  } else {
    // Code has expired or doesn't exist, show the form
    document.getElementById("referralForm").style.display = "block";
    document.getElementById("flyer1").style.display = "none";
    document.getElementById("flyer2").style.display = "none";
    document.getElementById("flyer3").style.display = "none";
  }
});
</script>


</body>
</html>
