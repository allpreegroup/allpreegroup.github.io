<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Deals</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .brand-block {
      margin-bottom: 30px;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
    }
    .brand img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .brand-name {
      font-weight: bold;
      font-size: 18px;
    }
    .deal-scroll {
      display: flex;
      gap: 15px;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    .deal {
      background: white;
      border-radius: 10px;
      min-width: 47%;
      position: relative;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      cursor: pointer;
    }
    .deal img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-top-left-radius: 10px;
      border-top-right-radius: 10px;
    }
    .deal-content {
      padding: 10px;
    }
    .deal-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .price {
      color: #999;
      text-decoration: line-through;
      font-size: 13px;
    }
    .discount {
      color: #e60000;
      font-weight: bold;
      font-size: 16px;
    }
    .discount-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: red;
      color: white;
      font-weight: bold;
      font-size: 12px;
      padding: 5px 8px;
      border-radius: 5px;
    }
    /* Popup styles */
    .popup {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .popup-content {
      background: white;
      width: 90%;
      max-width: 400px;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }
    .popup img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .popup-info {
      padding: 15px;
    }
    .popup-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .popup-price {
      text-decoration: line-through;
      color: #999;
    }
    .popup-discount {
      font-size: 24px;
      color: #e60000;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .popup-desc {
      font-size: 14px;
    }
    .close-popup {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 24px;
      cursor: pointer;
      font-weight: bold;
      color: #333;
    }
  </style>
</head>
<body>
  <h1>Today’s Deals</h1>
  <div id="deal-container"></div>

  <div class="popup" id="popup">
    <div class="popup-content">
      <span class="close-popup" onclick="closePopup()">×</span>
      <img id="popup-img" src="" alt="">
      <div class="popup-info">
        <div class="popup-title" id="popup-title"></div>
        <div class="popup-price" id="popup-original"></div>
        <div class="popup-discount" id="popup-discount"></div>
        <div class="popup-desc" id="popup-desc"></div>
      </div>
    </div>
  </div>

  <script>
    const sheetUrl = 'https://opensheet.elk.sh/1HZV3d6c7ywxDiA-YnVl7x_ZXp0GRw4F5CANsvfbh-Zs/Deals';

    async function loadDeals() {
      const res = await fetch(sheetUrl);
      const data = await res.json();

      const grouped = [];
      let currentBrand = null;

      data.forEach(row => {
        if (row.BrandName && row.BrandLogo) {
          currentBrand = { name: row.BrandName, logo: row.BrandLogo, deals: [] };
          grouped.push(currentBrand);
        } else if (currentBrand && row.ProductName) {
          currentBrand.deals.push(row);
        }
      });

      const container = document.getElementById('deal-container');
      grouped.forEach(brand => {
        const block = document.createElement('div');
        block.className = 'brand-block';

        const brandHTML = `
          <div class="brand">
            <img src="${brand.logo}" alt="${brand.name}" />
            <span class="brand-name">${brand.name}</span>
          </div>
          <div class="deal-scroll">
            ${brand.deals.map(deal => {
              const discountPercent = Math.round(((parseFloat(deal.OriginalPrice) - parseFloat(deal.DiscountPrice)) / parseFloat(deal.OriginalPrice)) * 100);
              const title = deal.ProductName.length > 10 ? deal.ProductName.slice(0, 10) + '...' : deal.ProductName;
              return `
                <div class="deal" onclick='openPopup(${JSON.stringify(deal).replace(/'/g, "\\'")})'>
                  <span class="discount-badge">-${discountPercent}%</span>
                  <img src="${deal.ImageURL}" alt="${deal.ProductName}">
                  <div class="deal-content">
                    <div class="deal-title">${title}</div>
                    <div class="price">JMD ${deal.OriginalPrice}</div>
                    <div class="discount">JMD ${deal.DiscountPrice}</div>
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        `;
        block.innerHTML = brandHTML;
        container.appendChild(block);
      });
    }

    function openPopup(deal) {
      document.getElementById('popup-img').src = deal.ImageURL;
      document.getElementById('popup-title').textContent = deal.ProductName;
      document.getElementById('popup-original').textContent = 'Original Price: JMD ' + deal.OriginalPrice;
      document.getElementById('popup-discount').textContent = 'Now: JMD ' + deal.DiscountPrice;
      document.getElementById('popup-desc').textContent = deal.Description || '';
      document.getElementById('popup').style.display = 'flex';
    }

    function closePopup() {
      document.getElementById('popup').style.display = 'none';
    }

    loadDeals();
  </script>
</body>
</html>
